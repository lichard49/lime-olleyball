	<html>
	<head>
		<title>Lime Olleyball - A Slime Volleyball remake</title>
		<link rel="shortcut icon" type="image/png" href="res/lime.png"/>
		<script src="jquery-2.1.4.min.js"></script>
		<script src="character.js"></script>
		<script src="ball.js"></script>
		<script src="world.js"></script>
		<script type="text/javascript">
		$(document).ready(function() {
			var canvas = document.getElementById("game_canvas");
			canvas.width = document.body.clientWidth; //document.width is obsolete
			canvas.height = document.body.clientHeight; //document.height is obsolete
			var context = canvas.getContext("2d");

			// game state
			var START_SCREEN = 0;
			var SET_UP_ROUND = 1;
			var ROUND_IN_PLAY = 2;
			var CLEAN_UP_ROUND = 3;
			var GAME_OVER = 4;
			var gameState = 1;
			var roundWinner = 0;

			// background
			var world = new World(canvas);

			// character
			var player1DefaultX = world.floorWidth/4;
			var player2DefaultX = 3*world.floorWidth/4;
			var player1DefaultY = world.floorY;
			var player2DefaultY = world.floorY;


			var player1 = new Character(player1DefaultX, player1DefaultY, 'red', false);
			var player2 = new Character(player2DefaultX, player2DefaultY, 'blue', true);

			var player1Score = 0;
			var player2Score = 0;

			// ball
			var ball = new Ball(player1DefaultX, world.floorY-600, player2DefaultX);

			function drawWorld(context) {
				world.draw(context);
				player1.draw(context);
				player2.draw(context);
				ball.draw(context);

				context.font = "50px Arial";
				context.fillStyle = "white";
				context.fillText(player1Score, world.floorWidth/4, world.floorY+world.floorHeight/2);
				context.fillText(player2Score, 3*world.floorWidth/4, world.floorY+world.floorHeight/2);
			}
			drawWorld(context);

			function drawWinner(winner) {
				context.font = "50px Arial";
				context.fillStyle = "white";
				var text = " wins!";
				switch(winner) {
					case 1: text = "Lime"+text; break;
					case 2: text = "Lemon"+text; break;
				}
				context.fillText(text, world.floorWidth/2-120, world.floorY+world.floorHeight/2);
			}

			window.onkeydown = function(e) {
				var key = e.keyCode ? e.keyCode : e.which;

				switch(key) {
					// left arrow
					case 39: player2.moveLeft(); break;
					// right arrow
					case 37: player2.moveRight(); break;
					// up arrow
					case 38: player2.jump(); break;
					// down arrow
					case 40: console.log("player 1 fall"); break;
					// 'A'
					case 68: player1.moveLeft(); break;
					// 'D'
					case 65: player1.moveRight(); break;
					// 'W'
					case 87: player1.jump(); break;
					// 'S'
					case 83: console.log("player 2 fall"); break;
				}
			}

			window.onkeyup = function(e) {
				var key = e.keyCode ? e.keyCode : e.which;

				switch(key) {
					// cascading switch
					case 39:
					case 37:
						player2.stop();
						break;
					case 65:
					case 68:
						player1.stop();
						break;
				}
			}

			setInterval(function() {
				switch(gameState) {
					case START_SCREEN:
						// show menu
						player1Score = 0;
						player2Score = 0;

						// go straight to game for now
						gameState = SET_UP_ROUND;

						break;
					case SET_UP_ROUND:
						// reset variables
						player1.reset();
						player2.reset();
						ball.reset(roundWinner == 1 ? 2 : 1);
						gameState = ROUND_IN_PLAY;

						break;
					case ROUND_IN_PLAY:
						// tick
						player1.tick(world);
						player2.tick(world);

						roundWinner = ball.tick(world, [player1, player2]);
						if(roundWinner > 0) {
							gameState = CLEAN_UP_ROUND;
						}

						drawWorld(context);

						break;
					case CLEAN_UP_ROUND:
						// increment scores
						switch(roundWinner) {
							case 1:
								player1Score += 1;
								break;
							case 2:
								player2Score += 1;
								break;
						}

						// end of game?
						if(player1Score >= 5 || player2Score >= 5) {
							gameState = GAME_OVER;
						}
						else {
							gameState = SET_UP_ROUND;
						}

						break;
					case GAME_OVER:
						// ?
						drawWorld(context);
						drawWinner(player1Score > player2Score ? 1 : 2);
						break;
				}
			}, 1);
		});
		</script>
	</head>

	<body id="body" style="padding: 0px; margin: 0px;">
		<canvas id="game_canvas"></canvas>
		<img id="lime" src="res/lime.png" style="display: none;" />
		<img id="lemon" src="res/lemon.png" style="display: none;" />
	</body>

	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-71618590-1', 'auto');
		ga('send', 'pageview');
	</script>
</html>